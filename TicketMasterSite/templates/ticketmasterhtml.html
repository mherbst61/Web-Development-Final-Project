<!DOCTYPE html>
<html lang="en" data-bs-theme= "light">
<head>
    <meta charset="UTF-8">
    <title>Ticketmaster Final Matt Herbst</title>
    {% load django_bootstrap5 %}
    {% bootstrap_css %}
    {% bootstrap_javascript %}
    <script>

    </script>
</head>
<body>
<nav id="navBar" class="navbar navbar-expand-lg fixed-top" >
    <div class="container">
  <a class="navbar-brand" href="#">TicketFinder</a>
<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <div class="navbar-nav">
        <li class="nav-item">
      <a class="nav-item nav-link" href="{% url 'home' %}">Home</a>
        </li>
        <li class="nav-item">
      <a class="nav-item nav-link active" href="{% url 'searchPage' %}">Search <span class="sr-only">(current)</span></a>
        </li>
            <li class="nav-item">
      <a class="nav-item nav-link" href="{% url 'loadTickets' %}">Saved Tickets</a>
       </li>
    </div>
  </div>
      <div class="form-check form-switch">
  <input id="Darkmode" class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault" onchange="darkmodeSet()">
  <label class="form-check-label" for="flexSwitchCheckDefault">Dark Mode</label>
</div>
    </div>
</nav>

<div class="topBar p-lg-5 p-0 mb-3">
    <div class="text-center container-fluid" id="topText">
        <p class="fs-1">Ticketmaster Search</p>
        <p class="fs-3 fw-bold">Quickly Find tickets around you</p>
    </div>
    <div>
        <form action="{% url 'search' %}" class="container-fluid" method="post">
            {% csrf_token %}
            <div class="input-group mb-3">
                {{ search_form.state }}
                {{ search_form.genre }}
                <datalist id="datalistOptions">
                    <option value="Music">
                    <option value="Sports">
                    <option value="Theater">
                    <option value="Family">
                    <option value="Arts&Theater">
                    <option value="Concerts">
                    <option value="Comedy">
                    <option value="Dance">
                </datalist>
                {{ search_form.city }}
                <button type="submit" class="btn btn-primary">Search</button>
            </div>
        </form>
    </div>

    <div class="mt-2 pb-2" id="alertArea">

    </div>

</div>
<!-- This div is a placeholder for the information coming from the API -->
{% if tickets%}
<div class="container shadow-lg p-lg-5 pt-3" id="results">

    {% if not message == "" %}
        <div class="row fs-5 fw-semibold">
        <div class="col-12 text-secondary">
            <p>{{message}}</p>
        </div>
    {% endif %}



    {% for ticket in tickets %}
        <div class="row h-4 shadow-lg p-3 mb-2 bg-body-tertiary rounded">
            <div class="col-lg-4 col-12">
                <img src="{{ ticket.event_imageUrl }}" class="img-fluid rounded" alt="event-img"/>
            </div>
            <div class="col-lg-4 col-6 mt-lg-0 mt-3">
                <p class="fs-4">{{ ticket.event_name }}</p>
                <p class="fs-5"><i class="bi bi-geo-alt-fill"></i> {{ ticket.theater_name }}</p>
                <p></p>
                <p>{{ ticket.theater_address1 }}<br>{{ ticket.theater_address2 }}</p>
            </div>
            <div class="col-lg-4 col-6 mt-lg-0 mt-3 text-end text-primary-emphasis">
                <p class="text-primary-emphasis fw-bold fs-5">{{ ticket.event_date }}</p>
                <p class="text-primary-emphasis fw-bold fs-4">{{ ticket.event_time }}</p>
                <div class="d-flex justify-content-end gap-2">
                     <a type="button" class="btn btn-outline-primary" href={{ ticket.event_url }} target="_blank"><i
                        class="bi bi-ticket-detailed-fill"></i> View Ticket</a>
                    <button style="display:{{ticket.saveButton}}" onclick="saveTicket('{{ ticket.event_name }}','{{ ticket.event_url  }}','{{ ticket.theater_name  }}','{{ ticket.theater_address1  }}','{{ ticket.theater_address2  }}','{{ ticket.event_imageUrl  }}','{{ ticket.event_ConvertedDate  }}','{{ ticket.event_ConvertedTime  }}','{{ ticket.ticket_id  }}')" id="saveButton" class="btn btn-outline-primary"><i class="bi bi-save"></i> Save Ticket</button>

                </div>
            </div>
        </div>
    {% endfor %}

    </div>
{% endif %}
</div>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
<script>
      window.onload=function (){
        darkmodeSwitchSet()
    }

    function darkmodeSwitchSet(){
        let darkmodeCookie = decodeURIComponent(document.cookie);
        var darkModeSwitch = document.getElementById("Darkmode");

        if(darkmodeCookie.includes("true")){
            darkModeSwitch.checked = true;
            console.log("Cookie returned true");
            darkmodeChanger(true);
        }else{
            darkModeSwitch.checked = false;
            console.log("Cookie returned false");
            darkmodeChanger(false);
        }
    }
    function darkmodeSet(){
        var darkModeSwitch = document.getElementById("Darkmode")
        if (darkModeSwitch.checked){
            document.cookie = "darkModeEnable= true; path=/"
            console.log("darkmodeSet Says:"+document.cookie)
            darkmodeChanger(true);
        }else{
            darkModeCheck = false;
            document.cookie = "darkModeEnable= false; path=/"
            console.log("darkmodeSet Says:"+document.cookie)
            darkmodeChanger(false);
        }
    }

    function darkmodeChanger(state){
        const navbar = document.getElementById("navBar");
        if(state){
            document.documentElement.setAttribute('data-bs-theme', 'dark');
            navbar.classList.remove("bg-light");
            navbar.classList.add("bg-dark");
        }else{
            document.documentElement.setAttribute('data-bs-theme', 'light');
            navbar.classList.remove("bg-dark");
            navbar.classList.add("bg-light");
        }
    }

    function saveTicket(eventName,eventUrl,theaterName,theaterAddress1,theaterAddress2,eventImageUrl,event_Date,event_Time,ticketId){
        console.log("Save ticket ran")
        $.ajax({
            type: 'POST',
            url: {% url 'savedTickets' %},
            data: {
                event_name: eventName,
            event_url: eventUrl,
            theater_name: theaterName,
            theater_address1: theaterAddress1,
            theater_address2: theaterAddress2,
            event_imageUrl: eventImageUrl,
            event_Date: event_Date,
            event_Time: event_Time,
            ticket_id: ticketId,
            csrfmiddlewaretoken: '{{ csrf_token }}'
            },
        })
            .done((data) => {
                alert(data.message);
            })
            .fail((err) => {
                alert("Ticket Failed to save: ",err);
            })
    }

</script>


{% block body %}
{% endblock %}

</body>
</html>